@page "/"
@rendermode InteractiveServer

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>
<p>Welcome to your new app.</p>

<div>
    <InputFile OnChange="HandleFileUpload" accept="image/*"/>
    @if (imagePreview != null)
    {
        <img src="@imagePreview" alt="Uploaded Image" style="max-width: 300px; max-height: 300px;"/>
    }
</div>

@code {
    private string imagePreview;
    private string errorMessage;

    private async Task HandleFileUpload(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file != null)
        {
            try
            {
                var buffer = new byte[file.Size];
                await file.OpenReadStream(1024 * 1024 * 15).ReadAsync(buffer); // Set the limit to 1MB
                var mimeType = file.ContentType;
                imagePreview = $"data:{mimeType};base64,{Convert.ToBase64String(buffer)}";
                errorMessage = null; // Clear previous error messages if any
            }
            catch (IOException ex)
            {
                errorMessage = $"File size exceeds the maximum allowed limit. Please upload a file smaller than 1MB.";
                imagePreview = null; // Clear the image preview if it exists
            }
        }
   }
}
